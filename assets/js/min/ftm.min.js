(function(){function t(b,a,c,e,d){var m=d3.carto.layer.featureArray();m.features(topojson.feature(b,b.objects[a]).features).renderMode("svg");null!==c&&m.label(c);null!==e&&m.cssClass(e);null!==d&&m.clickableFeatures(d);return m}function W(b){var a=b[e];if(void 0===a||""===a||!a&&0!==a)return"dark_gray";if(0>=+a&&h===k.header)return"light_gray";a=+a;if(z.get([h,e])){var c=z.get([h,e]),d;h===q.header?(c=c._[b.ST_CNTY],f=q.num_cats):f=k.num_cats;for(b=0;b<f;b+=1)if(d=h===k.header?100/f*(b+1):100/(f-
1)*b,a<=+c[d])return"q"+b+"-"+f;return 0==+a?"dark_gray":"q"+(f-1)+"-"+f}c=percentrank(g[e],+a);return"#N/A"===c||"NA"===c?(console.log("out of bounds error for val: "+a),"dark_gray"):"q"+Math.floor(f*c)+"-"+f}function X(b){b=+b["100"];var a,c=[];for(a=1;a<b;a*=100)c.push((b/a).toPrecision(2));return c}function Y(b,a,c){b||c||console.log("noVal");b=a+n;a=B.get([d3.select(".wc_highlight.selected")[0][0].id,b])[e];return{cx:b,cy:a}}function Z(b){$("#maptip").fadeTo(1E3,0,function(){$("#maptip").alert("close")});
K=d3.select("#map").append("div").attr("id","maptip").attr("class","alert alert-info alert-dismissible fade in out").attr("role","alert").on("mousedown",function(){$("#maptip").alert("close")});K.append("div").attr("class","tooltext").text(b).append("button").attr("class","close").attr("data-dismiss","alert").attr("aria-label","close").append("span").attr("aria-hidden","true").html("&times;")}function x(){d3.selectAll("g.wc").selectAll("path").attr("class",function(b){var a="wc";if(b=B.get([b.id,
d]))b=W(b),a+=" "+b;this.classList.contains("selected")&&(a+=" selected");return a})}function E(){function b(){var a=Math.round(g.extent()[0]);a<n?a=n:a>r&&(a=r);A.value(a);d=a;C();console.log("brush selected: "+a)}d3.selectAll("#linechart_legend > *").remove();d3.selectAll("#linechart_svg > *").remove();var a="Payment History",c="Select A County",f="To View Data",c=X(z.get([k.header,e])),f=z.get([k.header,e])["100"],w=d3.scale.linear().domain([n,r+2]).range([50,911]),m=d3.scale.log().clamp(!0).domain([1,
f]).range([155,10]),g=d3.svg.brush().x(w).extent([d-.05,d+.05]).on("brush",function(){g.extent();var a,c=Math.round(w.invert(d3.mouse(this)[0])),e=!1;c<n?(c=n,e=!0):c>r&&(c=r,e=!0);a=[c-.05,c+.05];console.log("brushed: "+a);e&&b(!0);brushtip.classed("hidden",!1).attr("style","left:"+(w(c)-9)+"px;top:90px").html("<div class='tooltext'>"+c+": "+a+"</div><div class='arrow-down center'></div>");console.log(brushtip);d3.select(this).call(g.extent(a))}),f=d3.svg.axis().scale(w).orient("bottom").tickFormat(d3.format("4d")).tickSize(5),
c=d3.svg.axis().scale(m).orient("left").tickValues(c).tickFormat(d3.format("$1s")).tickSize(5);y.append("g").attr("class","x axis").attr("transform","translate(0,155)").attr("stroke-width","1px").call(f);y.append("g").attr("class","y axis").attr("transform","translate(50,0)").attr("stroke-width","1px").call(c);c=d3.svg.line().x(function(a){return w(a.YEAR)}).y(function(a){return"NA"===a[e]?m(0):m(a[e])});y.append("path").datum(D).attr("class","line").attr("d",c).attr("fill","none").attr("stroke",
"#636260").attr("stroke-width","1.25px");y.append("circle").attr("id","average_circle").attr("cx",function(){return w(d)}).attr("cy",function(){return"NA"===D[d-n][e]?m(0):m(D[d-n][e])}).attr("r",3).attr("stroke-width",1.5).attr("stroke","#636260").attr("fill","#F4F2EE");var l=d3.select("#linechart_legend");if(d3.select(".wc_highlight.selected")[0][0]){var h=d3.select(".wc_highlight.selected")[0][0].id,p=B.get([h,d]);if(p){var a=p.COUNTY+" County Payment History",c=p.COUNTY+" County",f=p.STATE,q=
d,t=p[e],p=Array.apply(null,{length:r-n+1}).map(Y),u=0,v=1970,h=L.get(h)[e];p.forEach(function(a){+a.cy>u&&(u=a.cy,v=a.cx)});var x="<strong>"+c+"</strong> received its maximum payment in <strong>"+v+"</strong> of "+F(u),x=void 0!==h&&null!==h&&"-"!==h?x+(" and ranks in the <strong> "+h+"</strong> of all counties historically"):"<strong>"+c+"</strong> is not elligble for the"+e+" Program";d3.select("#linechart_summary").html(x);h=d3.svg.line().x(function(a){return w(a.cx)}).y(function(a){return m(a.cy)});
y.append("path").datum(p).attr("class","line").attr("d",h).attr("fill","none").attr("stroke","#F38347").attr("stroke-width","1.25px");y.append("circle").attr("id","active_circle").attr("cx",function(){return w(q)}).attr("cy",function(){return m(t)}).attr("r",3).attr("stroke-width",1.5).attr("stroke","#F38347").attr("fill","#F4F2EE");p=[w(q),m(t)].map(function(a){return parseInt(a,10)});M.classed("hidden",!1).attr("style","left:"+(p[0]-9)+"px;top:"+(p[1]-38)+"px").html("<div class='tooltext'>"+d+": "+
F(t)+"</div><div class='arrow-down center'></div>");p=l.append("div").classed("current_legend_label",!0);p.append("div").classed("legend_line",!0).style("background-color","#F38347");p.append("div").classed("legend_label",!0).text(c);p.append("div").classed("",!0).text(f)}}d3.selectAll("#linechart_title").text(a);a=l.append("div").classed("all_counties_legend_label",!0);a.append("div").classed("legend_line",!0).style("background-color","#636260");a.append("div").classed("legend_label",!0).html("Western States");
a.append("div").classed("",!0).html("Median of Counties<br>Receiving Funds");y.append("g").attr("class","brush").call(g).on("mouseup",b).selectAll("rect").attr("height",180).on("hover",function(a){})}function C(){d3.select("#year").text(d);d===n?d3.select("#prev_btn").attr("disabled",!0):d3.select("#prev_btn").attr("disabled",null);d===r?d3.select("#next_btn").attr("disabled",!0):d3.select("#next_btn").attr("disabled",null);x();E()}function G(){var b=d3.select("#legend"),a=z.get([k.header,e]),c,d,
g,m;d3.selectAll("#legend > *").remove();h===q.header?(d3.select("#legend").classed(q.break_class,!0).classed(k.break_class,!1),f=q.num_cats):(d3.select("#legend").classed(q.break_class,!1).classed(k.break_class,!0),f=k.num_cats);for(c=f;0<=c;c--)h===k.header?(d=100/f*c,g=F(a[d])):g=q.break_labels[c],m="q"+c+"-"+f,d=b.append("div").classed("min_height",!0).classed("legend_key",!0),d.append("div").classed(m,!0).classed("legend_color",c!==f).classed("legend_color_null",c===f),d.append("div").classed("legend_color",
c!==f).classed("legend_color_null",c===f),d.append("div").classed("legend_class",c!==f).classed("legend_class_null",c===f).attr("height","200px").text(g);h===k.header&&(d=b.append("div").classed("min_height",!0).classed("legend_key",!0),d.append("div").classed("light_gray",!0).classed("legend_color",!0),d.append("div").classed("legend_color",!0),d.append("div").classed("legend_class",!0).attr("height","200px").text("NONE"))}function N(b){var a=d3.select("#program_description_area .btn-primary")[0][0].attributes.title.value;
d3.select("#program_description_text").html(b[a])}function O(b){d3.select("#program_description_area").select("h3").text(b.program_title);N(b)}function aa(){var b=d3.select("#timeline_controls");b.select("#prev_btn").on("click",function(){d!==n&&(--d,A.value(d),C())});b.select("#next_btn").on("click",function(){d!==r&&(d+=1,A.value(d),C())});C();A=slider(n,r,568,n,r).value(d);A.callback(function(){d=A.value();C()});d3.select("#timeline").append("svg").call(A)}function ba(){d3.json("data/menu.json",
function(b){b.menuitems.forEach(function(a){var b=a.id;u.set(a.id,a);d3.csv("data/intra_county_class_breaks/"+a.id+"_intra_county_class_breaks.csv",function(a){var d=d3.map();a.forEach(function(a){d.set(a.county,a)});z.set([q.header,b],d)});var f;f=a.active?null:!0;d3.select("#program_menu").append("div").text(a.menu_abbrev).attr("id",a.id).attr("program_title",a.program_title).attr("class","btn").attr("disabled",f).classed("btn-primary",e===a.id).classed("btn-default",e!==a.id).classed("menuitem",
!0).on("click",function(){e=this.id;d3.selectAll("#program_menu .btn-primary").classed("btn-primary",!1).classed("btn-default",!0);d3.select(this).classed("btn-primary",!0).classed("btn-default",!1);var a=u.get(e).start_year,b=u.get(this.id).program_title;d<a&&Z(b+" program funds begin in "+a);x();G();O(u.get(e));E()}).on("mouseenter",function(a){a=d3.mouse(d3.select("#program_menu").node()).map(function(a){return parseInt(a,10)});var b=u.get(this.id).program_title;H.classed("hidden",!1).attr("style",
"left:"+(a[0]-50)+"px;top:"+(a[1]+10)+"px").html("<div class='tooltext'>"+b+"</div>")}).on("mouseout",function(){H.classed("hidden",!0)})});O(u.get(e))});d3.selectAll("#description_trends_toggle_btn_container .btn").on("click",function(){d3.selectAll("#description_trends_toggle_btn_container > .btn-primary").classed("btn-primary",!1).classed("btn-default",!0);d3.select(this).classed("btn-primary",!0).classed("btn-default",!1);N(u.get(e))})}function ca(){v.g().classed(k.break_class,!0);d3.selectAll("g.wc").attr("id",
function(b){return b.id}).attr("state",function(b){return b.id.split("_")[0]});d3.geo.path().projection(l.projection());d3.selectAll("g.wc_highlight").attr("id",function(b){return b.id}).on("mousedown",function(){d3.selectAll(".selected").classed("selected",!1);d3.select(this).classed("selected",!0);d3.select(this).selectAll("path").classed("selected",!0);d3.selectAll("#"+this.id).classed("selected",!0).selectAll("path").classed("selected",!0);E()}).on("mouseenter",function(b){b=B.get([b.id,d]);var a=
d3.mouse(d3.select("#d3MapSVG").node()).map(function(a){return parseInt(a,10)});I.classed("hidden",!1).attr("style","left:"+(a[0]-30)+"px;top:"+(a[1]+20)+"px").html("<div class='tooltext'>"+b.COUNTY+", "+b.STATE+"</div>")}).on("mouseout",function(){I.classed("hidden",!0)});x()}function da(){d3.selectAll("g.country_background").attr("filter","url(#dropshadow)")}function ea(){}function fa(){P=t(g.usa_background,"usa_back_wgs84_geo","Background","country_background",!1).on("load",da);Q=t(g.usa_background,
"usa_back_wgs84_geo","Borders","country_foreground",!1);R=t(g.other_states_borders,"osb_wgs84_geo","Other States","other_state",!1);S=t(g.other_countries_borders,"ocb_wgs84_geo","Other Countries","light_border",!1);T=t(g.highlighted_states,"hsb_wgs84_geo","Highlighted States","state",!1).on("load",ea);v=t(g.wc,"wc_wgs84_geo","Counties","wc",!0);U=t(g.wc,"wc_wgs84_geo","Counties","wc_highlight",!0).on("load",ca);var b=g.cities.objects.cities_geo.geometries;J=d3.carto.layer.xyArray();J.features(b).cssClass("capital").renderMode("svg").markerSize(210).x(function(a){return a.coordinates[0]}).y(function(a){return a.coordinates[1]}).clickableFeatures(!0)}
function ga(b,a){b?console.error(b):(g.wc=a[0],g.usa_background=a[1],g.usa_borders=a[2],g.other_states_borders=a[3],g.other_countries_borders=a[4],g.highlighted_states=a[5],g.cities=a[6],V=d3.geo.albers().center([3,25]),l=d3.carto.map(),d3.selectAll("#map > .circle").remove(),d3.selectAll("#map > .circle1").remove(),d3.select("#map").call(l),l.mode("projection"),l.projection(V),l.zoom().scale(1800).scaleExtent([1800,1E4]),l.centerOn([-.27,-.04],"scaled"),d3.select("#d3MapSVG").append("defs").append("filter").attr("id",
"dropshadow").append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",5),fa(),l.addCartoLayer(P),l.addCartoLayer(S),l.addCartoLayer(Q),l.addCartoLayer(R),l.addCartoLayer(v),l.addCartoLayer(T),l.addCartoLayer(U),l.addCartoLayer(J),aa(),G())}var l,g={},V,I,K,P,S,Q,R,v,T,U,J,h,k={header:"Inter-County Payments",sub_header:"in 2014 dollars",break_class:"YlGn",num_cats:5},q={header:"Intra-County Payments",sub_header:"Each county's payment compared to its historical average",break_class:"RdBl",
num_cats:6,break_labels:"Minimum Received;;;Average Received;;;Maximum Received".split(";")},d,n,r,A,y,M,e,f,H,B=d3.map(),z=d3.map(),D=[],L=d3.map(),u=d3.map(),F=d3.format("$,f");d3.format(".0%");(function(){r=n=d=1979;e="L_CFG";f=5;g[e]=[];h=k.header;d3.select("#map_toggle_btn").on("click",function(){h===k.header?(d3.select(this).select("#map_toggle_box").classed("active",!0),h=q.header,v.g().classed(k.break_class,!1),v.g().classed(q.break_class,!0)):(d3.select(this).select("#map_toggle_box").classed("active",
null),h=k.header,v.g().classed(q.break_class,!1),v.g().classed(k.break_class,!0));G();x()});y=d3.select("#linechart").append("svg").attr("id","linechart_svg").on("mouseover",function(b){});M=d3.select("#linechart").append("div").attr("class","tooltip hidden");I=d3.select("#map_row").append("div").attr("class","tooltip hidden");H=d3.select("#program_menu").append("div").attr("class","tooltip hidden");brushtip=d3.select("#linechart").append("div").attr("class","tooltip hidden");ba()})();(function(){var b=
queue(1);b.defer(d3.json,"topojson_files/Western_Counties_sm/wc_wgs84_topo.json").defer(d3.json,"topojson_files/USA_background/usa_back_wgs84_topo.json").defer(d3.json,"topojson_files/USA_borders/usa_b_wgs84_topo.json").defer(d3.json,"topojson_files/other_states_borders/osb_wgs84_topo.json").defer(d3.json,"topojson_files/other_countries_background/ocb_wgs84_topo.json").defer(d3.json,"topojson_files/highlighted_states_borders/hsb_wgs84_topo.json").defer(d3.json,"topojson_files/cities/cities_wgs84_topo.json").defer(d3.csv,
"data/Master_simple.csv",function(a){B.set([a.ST_CNTY,a.YEAR],a);""!==a[e]&&(0===+a[e]&&-1!==a[e].indexOf(0)||g[e].push(+a[e]));+a.YEAR>r?r=+a.YEAR:+a.YEAR<n&&(n=+a.YEAR)}).defer(d3.csv,"data/inter_county_class_breaks.csv",function(a){z.set([k.header,a.Program],a)}).defer(d3.csv,"data/us_medians_by_year.csv",function(a){D.push(a)}).defer(d3.csv,"data/county_ranks_overall.csv",function(a){L.set(a.county,a)});b.awaitAll(ga)})()})();
