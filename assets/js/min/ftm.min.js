(function(){function t(b,a,d,f,r){var c=d3.K.pa.na();c.M(topojson.ma(b,b.R[a]).M).ta("svg");null!==d&&c.label(d);null!==f&&c.ka(f);null!==r&&c.ia(r);return c}function V(b){var a=b[f];if(void 0===a||""===a||!a&&0!==a)return"dark_gray";if(0>=+a&&n===l.g)return"light_gray";a=+a;if(x.get([n,f])){var d=x.get([n,f]),c;n===k.g?(d=d.aa[b.Z],g=k.l):g=l.l;for(b=0;b<g;b+=1)if(c=n===l.g?100/g*(b+1):100/(g-1)*b,a<=+d[c])return"q"+b+"-"+g;return 0==+a?"dark_gray":"q"+(g-1)+"-"+g}d=percentrank(e[f],+a);return"#N/A"===
d||"NA"===d?(console.log("out of bounds error for val: "+a),"dark_gray"):"q"+Math.floor(g*d)+"-"+g}function W(b){b=+b["100"];var a,d=[];for(a=1;a<b;a*=100)d.push((b/a).toPrecision(2));return d}function X(b,a,d){b||d||console.log("noVal");b=a+m;a=B.get([d3.select(".wc_highlight.selected")[0][0].id,b])[f];return{C:b,u:a}}function Y(b){$("#maptip").la(1E3,0,function(){$("#maptip").alert("close")});I=d3.select("#map").append("div").a("id","maptip").a("class","alert alert-info alert-dismissible fade in out").a("role",
"alert").f("mousedown",function(){$("#maptip").alert("close")});I.append("div").a("class","tooltext").text(b).append("button").a("class","close").a("data-dismiss","alert").a("aria-label","close").append("span").a("aria-hidden","true").i("&times;")}function y(){d3.c("g.wc").c("path").a("class",function(b){var a="wc";if(b=B.get([b.id,c]))b=V(b),a+=" "+b;this.classList.contains("selected")&&(a+=" selected");return a})}function z(){function b(){var a=Math.round(h.v()[0]);a<m?a=m:a>q&&(a=q);A.value(a);
c=a;C();console.log("brush selected: "+a)}d3.c("#linechart_legend > *").remove();d3.c("#linechart_svg > *").remove();var a="Payment History",d="Select A County",g="To View Data",d=W(x.get([l.g,f])),g=x.get([l.g,f])["100"],r=d3.scale.qa().domain([m,q+2]).V([50,911]),e=d3.scale.log().ha(!0).domain([1,g]).V([155,10]),h=d3.s.da().x(r).v([c-.05,c+.05]).f("brush",function(){h.v();var a,d=Math.round(r.oa(d3.D(this)[0])),c=!1;d<m?(d=m,c=!0):d>q&&(d=q,c=!0);a=[d-.05,d+.05];console.log("brushed: "+a);c&&b();
brushtip.b("hidden",!1).a("style","left:"+(r(d)-9)+"px;top:90px").i("<div class='tooltext'>"+d+": "+a+"</div><div class='arrow-down center'></div>");console.log(brushtip);d3.select(this).call(h.v(a))}),g=d3.s.axis().scale(r).S("bottom").X(d3.format("4d")).Y(5),d=d3.s.axis().scale(e).S("left").wa(d).X(d3.format("$1s")).Y(5);w.append("g").a("class","x axis").a("transform","translate(0,155)").a("stroke-width","1px").call(g);w.append("g").a("class","y axis").a("transform","translate(50,0)").a("stroke-width",
"1px").call(d);d=d3.s.P().x(function(a){return r(a.$)}).y(function(a){return"NA"===a[f]?e(0):e(a[f])});w.append("path").L(D).a("class","line").a("d",d).a("fill","none").a("stroke","#636260").a("stroke-width","1.25px");w.append("circle").a("id","average_circle").a("cx",function(){return r(c)}).a("cy",function(){return"NA"===D[c-m][f]?e(0):e(D[c-m][f])}).a("r",3).a("stroke-width",1.5).a("stroke","#636260").a("fill","#F4F2EE");var n=d3.select("#linechart_legend");if(d3.select(".wc_highlight.selected")[0][0]){var k=
d3.select(".wc_highlight.selected")[0][0].id,p=B.get([k,c]);if(p){var a=p.A+" County Payment History",d=p.A+" County",g=p.I,t=c,u=p[f],p=Array.apply(null,{length:q-m+1}).map(X),v=0,y=1970,k=J.get(k)[f];p.forEach(function(a){+a.u>v&&(v=a.u,y=a.C)});var z="<strong>"+d+"</strong> received its maximum payment in <strong>"+y+"</strong> of "+E(v),z=void 0!==k&&null!==k&&"-"!==k?z+(" and ranks in the <strong> "+k+"</strong> of all counties historically"):"<strong>"+d+"</strong> is not elligble for the"+
f+" Program";d3.select("#linechart_summary").i(z);k=d3.s.P().x(function(a){return r(a.C)}).y(function(a){return e(a.u)});w.append("path").L(p).a("class","line").a("d",k).a("fill","none").a("stroke","#F38347").a("stroke-width","1.25px");w.append("circle").a("id","active_circle").a("cx",function(){return r(t)}).a("cy",function(){return e(u)}).a("r",3).a("stroke-width",1.5).a("stroke","#F38347").a("fill","#F4F2EE");p=[r(t),e(u)].map(function(a){return parseInt(a,10)});K.b("hidden",!1).a("style","left:"+
(p[0]-9)+"px;top:"+(p[1]-38)+"px").i("<div class='tooltext'>"+c+": "+E(u)+"</div><div class='arrow-down center'></div>");p=n.append("div").b("current_legend_label",!0);p.append("div").b("legend_line",!0).style("background-color","#F38347");p.append("div").b("legend_label",!0).text(d);p.append("div").b("",!0).text(g)}}d3.c("#linechart_title").text(a);a=n.append("div").b("all_counties_legend_label",!0);a.append("div").b("legend_line",!0).style("background-color","#636260");a.append("div").b("legend_label",
!0).i("Western States");a.append("div").b("",!0).i("Median of Counties<br>Receiving Funds");w.append("g").a("class","brush").call(h).f("mouseup",b).c("rect").a("height",180).f("hover",function(){})}function C(){d3.select("#year").text(c);c===m?d3.select("#prev_btn").a("disabled",!0):d3.select("#prev_btn").a("disabled",null);c===q?d3.select("#next_btn").a("disabled",!0):d3.select("#next_btn").a("disabled",null);y();z()}function F(){var b=d3.select("#legend"),a=x.get([l.g,f]),d,c,e,h;d3.c("#legend > *").remove();
n===k.g?(d3.select("#legend").b(k.h,!0).b(l.h,!1),g=k.l):(d3.select("#legend").b(k.h,!1).b(l.h,!0),g=l.l);for(d=g;0<=d;d--)n===l.g?(c=100/g*d,e=E(a[c])):e=k.J[d],h="q"+d+"-"+g,c=b.append("div").b("min_height",!0).b("legend_key",!0),c.append("div").b(h,!0).b("legend_color",d!==g).b("legend_color_null",d===g),c.append("div").b("legend_color",d!==g).b("legend_color_null",d===g),c.append("div").b("legend_class",d!==g).b("legend_class_null",d===g).a("height","200px").text(e);n===l.g&&(c=b.append("div").b("min_height",
!0).b("legend_key",!0),c.append("div").b("light_gray",!0).b("legend_color",!0),c.append("div").b("legend_color",!0),c.append("div").b("legend_class",!0).a("height","200px").text("NONE"))}function L(b){var a=d3.select("#program_description_area .btn-primary")[0][0].attributes.title.value;d3.select("#program_description_text").i(b[a])}function M(b){d3.select("#program_description_area").select("h3").text(b.w);L(b)}function Z(){var b=d3.select("#timeline_controls");b.select("#prev_btn").f("click",function(){c!==
m&&(--c,A.value(c),C())});b.select("#next_btn").f("click",function(){c!==q&&(c+=1,A.value(c),C())});C();A=slider(m,q,568,m,q).value(c);A.ea(function(){c=A.value();C()});d3.select("#timeline").append("svg").call(A)}function aa(){d3.json("data/menu.json",function(b){b.sa.forEach(function(a){var b=a.id;u.set(a.id,a);d3.m("data/intra_county_class_breaks/"+a.id+"_intra_county_class_breaks.csv",function(a){var c=d3.map();a.forEach(function(a){c.set(a.ja,a)});x.set([k.g,b],c)});var e;e=a.active?null:!0;
d3.select("#program_menu").append("div").text(a.ra).a("id",a.id).a("program_title",a.w).a("class","btn").a("disabled",e).b("btn-primary",f===a.id).b("btn-default",f!==a.id).b("menuitem",!0).f("click",function(){f=this.id;d3.c("#program_menu .btn-primary").b("btn-primary",!1).b("btn-default",!0);d3.select(this).b("btn-primary",!0).b("btn-default",!1);console.log(a);var b=u.get(f).va,d=u.get(this.id).w;c<b&&Y(d+" program funds begin in "+b);b="/pages/"+a.id+".html";console.log(b);d3.select("#program_description_btn").a("href",
b);console.log(d3.select("#program_description_btn"));y();F();M(u.get(f));z()}).f("mouseenter",function(){var a=d3.D(d3.select("#program_menu").node()).map(function(a){return parseInt(a,10)}),b=u.get(this.id).w;G.b("hidden",!1).a("style","left:"+(a[0]-50)+"px;top:"+(a[1]+10)+"px").i("<div class='tooltext'>"+b+"</div>")}).f("mouseout",function(){G.b("hidden",!0)})});M(u.get(f))});d3.c("#description_trends_toggle_btn_container .btn").f("click",function(){d3.c("#description_trends_toggle_btn_container > .btn-primary").b("btn-primary",
!1).b("btn-default",!0);d3.select(this).b("btn-primary",!0).b("btn-default",!1);L(u.get(f))})}function ba(){v.o().b(l.h,!0);d3.c("g.wc").a("id",function(b){return b.id}).a("state",function(b){return b.id.split("_")[0]});d3.N.path().F(h.F());d3.c("g.wc_highlight").a("id",function(b){return b.id}).f("mousedown",function(){d3.c(".selected").b("selected",!1);d3.select(this).b("selected",!0);d3.select(this).c("path").b("selected",!0);d3.c("#"+this.id).b("selected",!0).c("path").b("selected",!0);z()}).f("mouseenter",
function(b){b=B.get([b.id,c]);var a=d3.D(d3.select("#d3MapSVG").node()).map(function(a){return parseInt(a,10)});H.b("hidden",!1).a("style","left:"+(a[0]-30)+"px;top:"+(a[1]+20)+"px").i("<div class='tooltext'>"+b.A+", "+b.I+"</div>")}).f("mouseout",function(){H.b("hidden",!0)});y()}function ca(){d3.c("g.country_background").a("filter","url(#dropshadow)")}function da(){}function ea(b,a){b?console.error(b):(e.H=a[0],e.G=a[1],e.xa=a[2],e.U=a[3],e.T=a[4],e.O=a[5],e.B=a[6],N=d3.N.ba().fa([3,25]),h=d3.K.map(),
d3.c("#map > .circle").remove(),d3.c("#map > .circle1").remove(),d3.select("#map").call(h),h.mode("projection"),h.F(N),h.zoom().scale(1800).ua([1800,1E4]),h.ga([-.27,-.04],"scaled"),d3.select("#d3MapSVG").append("defs").append("filter").a("id","dropshadow").append("feGaussianBlur").a("in","SourceAlpha").a("stdDeviation",5),O=t(e.G,"usa_back_wgs84_geo","Background","country_background",!1).f("load",ca),P=t(e.G,"usa_back_wgs84_geo","Borders","country_foreground",!1),Q=t(e.U,"osb_wgs84_geo","Other States",
"other_state",!1),R=t(e.T,"ocb_wgs84_geo","Other Countries","light_border",!1),S=t(e.O,"hsb_wgs84_geo","Highlighted States","state",!1).f("load",da),v=t(e.H,"wc_wgs84_geo","Counties","wc",!0),T=t(e.H,"wc_wgs84_geo","Counties","wc_highlight",!0).f("load",ba),console.log(e.B.R),U=t(e.B,"cities_wgs84_geo","Cities","city",!1),h.j(O),h.j(R),h.j(P),h.j(Q),h.j(v),h.j(S),h.j(T),h.j(U),Z(),F())}var h,e={},N,H,I,O,R,P,Q,v,S,T,U,n,l={g:"Inter-County Payments",W:"in 2014 dollars",h:"YlGn",l:5},k={g:"Intra-County Payments",
W:"Each county's payment compared to its historical average",h:"RdBl",l:6,J:"Minimum Received;;;Average Received;;;Maximum Received".split(";")},c,m,q,A,w,K,f,g,G,B=d3.map(),x=d3.map(),D=[],J=d3.map(),u=d3.map(),E=d3.format("$,f");d3.format(".0%");(function(){q=m=c=1981;f="O_C";g=5;e[f]=[];n=l.g;d3.select("#map_toggle_btn").f("click",function(){n===l.g?(d3.select(this).select("#map_toggle_box").b("active",!0),n=k.g,v.o().b(l.h,!1),v.o().b(k.h,!0)):(d3.select(this).select("#map_toggle_box").b("active",
null),n=l.g,v.o().b(k.h,!1),v.o().b(l.h,!0));F();y()});w=d3.select("#linechart").append("svg").a("id","linechart_svg").f("mouseover",function(){});K=d3.select("#linechart").append("div").a("class","tooltip hidden");H=d3.select("#map_row").append("div").a("class","tooltip hidden");G=d3.select("#program_menu").append("div").a("class","tooltip hidden");brushtip=d3.select("#linechart").append("div").a("class","tooltip hidden");aa()})();(function(){var b=queue(1);b.defer(d3.json,"topojson_files/Western_Counties_sm/wc_wgs84_topo.json").defer(d3.json,
"topojson_files/USA_background/usa_back_wgs84_topo.json").defer(d3.json,"topojson_files/USA_borders/usa_b_wgs84_topo.json").defer(d3.json,"topojson_files/other_states_borders/osb_wgs84_topo.json").defer(d3.json,"topojson_files/other_countries_background/ocb_wgs84_topo.json").defer(d3.json,"topojson_files/highlighted_states_borders/hsb_wgs84_topo.json").defer(d3.json,"topojson_files/cities/cities_wgs84_topo2.json").defer(d3.m,"data/Master_simple.csv",function(a){B.set([a.ST_CNTY,a.YEAR],a);""!==a[f]&&
(0===+a[f]&&-1!==a[f].indexOf(0)||e[f].push(+a[f]));+a.YEAR>q?q=+a.YEAR:+a.YEAR<m&&(m=+a.YEAR)}).defer(d3.m,"data/inter_county_class_breaks.csv",function(a){x.set([l.g,a.Program],a);console.log(a.Program+": ");console.log(a)}).defer(d3.m,"data/us_medians_by_year.csv",function(a){D.push(a)}).defer(d3.m,"data/county_ranks_overall.csv",function(a){J.set(a.county,a)});b.ca(ea)})()})();
